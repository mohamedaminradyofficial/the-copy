قائمة TODO المتبقّية (مرتّبة بالأولوية)
أولًا: أولوية حرجة (قبل أي دمج)

توحيد نوع GeminiService وإزالة التعارض في BaseStation

المواقع الحرجة:
frontend/src/lib/ai/core/base-station.ts، الفرق بين:
../stations/gemini-service و ../gemini-service.

المطلوب: اعتماد نوع واحد واسترجاع خدمة واحدة متوافقة مع التوقيعات المستخدمة في BaseStation، وتحديث getGeminiService() لإرجاع النوع المعتمد.

معايير القبول:

لا توجد أخطاء TypeScript مرتبطة بـ GeminiService.

بناء الإنتاج يمرّ دون أخطاء بسبب هذا النوع.

تلميح تطبيقي سريع:

وحّد الاستيرادين إلى مصدر واحد، ثم عالج التوقيعات الداخلية بدل ازدواج التنفيذ/النوع.

إصلاح بناء الإنتاج (TypeScript) كاملًا

المطلوب: معالجة كل أخطاء TS المتبقية في طبقة الـ AI والملفات ذات الصلة حتى ينجح:
npm run build دون أي Error.

معايير القبول:

نجاح بناء الإنتاج محليًا في بيئة نظيفة.

إصلاح اختبار الوحدة لصفحة Home المرتبط بقراءة Manifest

المواقع الحرجة:
frontend/src/app/page.tsx و frontend/src/app/page.test.tsx و frontend/src/config/pages.manifest.json.

العَرَض المرصود: map is not a function عند استخدام pagesManifest.

المطلوب: ضمان أن المكوّن يقرأ Array صحيحة (أو pages من كائن) قبل الاستدعاء.

معايير القبول:

ينجح تشغيل: npm run test -- src/app/page.test.tsx.

لا تظهر أخطاء تحويل/استيراد JSON، ولا يتم استدعاء map على قيمة غير Array.

ثانيًا: أولوية متوسطة (تثبت الجاهزية)

تشغيل اختبارات E2E وتوليد أدلة Evidence فعلية

المطلوب: تشغيل Playwright لضمان الوصول إلى الصفحات الـ 11 وتوليد الأدلة تلقائيًا.

مخرجات مُتوقَّعة (تلقائيًا تحت):
frontend/evidence/<YYYY-MM-DD>/{logs, screens, network}

Screens: 11 لقطة شاشة (كل صفحة).

Network: 11 ملف HAR.

Logs: health.json و pages-discovered.json.

معايير القبول:

مجلد Evidence موجود وممتلئ بكل الملفات المشار إليها.

لا توجد سيناريوهات فاشلة بلا معالجة.

تشغيل سكربت CI والتحقق من Hooks (Husky) قبل الدفع

المطلوب:

تشغيل npm run ci محليًا والتأكد من النجاح.

تفعيل/التحقق من pre-push hook إن لزم (lint/test/e2e أو subset منطقي).

معايير القبول:

فشل أي خطوة يمنع الـ push محليًا حتى التصحيح.

سجّل النتائج في تقرير التشغيل.

ثالثًا: إقفال توثيقي/صحي

تحديث تقارير التشغيل

المطلوب: تحديث RUN_REPORT_CURRENT.md بنتائج فعلية (Build/E2E/Unit/CI) مع روابط مباشرة إلى أدلة Evidence (screens/HAR/logs).

معايير القبول:

التقرير يضمّ جدول حالة مُحدّث وروابط تُفتح وتعمل.

مراجعة الاعتمادات والتبعيات

المطلوب: تحقق سريع من سلامة التبعيات المثبتة وغياب المفقود/المكرر.

معايير القبول:

لا تحذيرات حرجة عند التثبيت والبناء.

لا تبعيات غير مُستخدمة بشكل صريح في البناء النهائي.

ترتيب التنفيذ الموصى به (سير عمل حتمي)

معالجة GeminiService وتوحيد النوع.

تصفير أخطاء TS وتشغيل npm run build.

إصلاح اختبار الوحدة للصفحة الرئيسية وتشغيل npm run test.

تشغيل npm run e2e وتحصيل Evidence (screens/HAR/logs).

تشغيل npm run ci والتحقق من hooks.

تحديث RUN_REPORT_CURRENT.md ببيانات فعلية وروابط أدلة.

أوامر مرجعية:

# 1) بناء نظيف
pnpm install
npm run build

# 2) اختبارات الوحدة (ركّز على الصفحة الرئيسية أولًا)
npm run test -- src/app/page.test.tsx
npm run test

# 3) E2E + الأدلة
cd frontend
npm run e2e

# 4) CI محلي
npm run ci
